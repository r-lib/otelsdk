<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Collecting Telemetry Data — Collecting Telemetry Data • otelsdk</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Collecting Telemetry Data — Collecting Telemetry Data"><meta name="description" content="This page is about collecting telemetry data from instrumented R
packages. If you need help with instrumenting your R package, see
Getting Started in the otel package."><meta property="og:description" content="This page is about collecting telemetry data from instrumented R
packages. If you need help with instrumenting your R package, see
Getting Started in the otel package."><script defer data-domain="all.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">otelsdk</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-getting-started" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Getting Started</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-getting-started"><li><a class="external-link dropdown-item" href="https://otel.r-lib.org/reference/gettingstarted.html">Instrumenting R Packages (otel package)</a></li>
    <li><a class="dropdown-item" href="../reference/collecting.html">Collecting Telemetry Data</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Collecting Telemetry Data</h1>
      <small class="dont-index">Source: <a href="https://github.com/r-lib/otelsdk/blob/main/R/docs.R" class="external-link"><code>R/docs.R</code></a></small>
      <div class="d-none name"><code>collecting.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This page is about collecting telemetry data from instrumented R
packages. If you need help with instrumenting your R package, see
<a href="https://otel.r-lib.org/reference/gettingstarted.html" class="external-link">Getting Started</a> in the otel package.</p>
    </div>


    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Not applicable.</p>
    </div>
    <div class="section level2">
    <h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a></h2>

<ul><li><p>Instrument your R package or project using the
<a href="https://github.com/r-lib/otel" class="external-link">otel</a> package.
Alternatively, use
<a href="https://otel.r-lib.org/reference/zci.html" class="external-link">Zero Code Instrumentation</a> to
automatically instrument selected packages.</p></li>
<li><p>Install the otelsdk package.</p></li>
<li><p>Choose an exporter from the otelsdk package. The <code>http</code> exporter sends
OpenTelemetry output through OTLP/HTTP.</p></li>
<li><p>Set the <code>OTEL_TRACES_EXPORTER</code> environment variable to point to the
exporter of your choice. E.g. for OTLP/HTTP set <code>OTEL_TRACES_EXPORTER=http</code>.</p></li>
<li><p>If you are sending telemetry data through HTTP, then you typically need
to configure the URL of your OpenTelemetry collector, and you possibly
also need to supply a token in an HTTP header, possibly some resource
attributes. Follow the instructions of the provider of your collector.
They typically don't have instructions for R, but generic instructions
about environment variables will work for the otelsdk R package. E.g. for
<a href="https://grafana.com/" class="external-link">Grafana</a> you need something like</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>OTEL_EXPORTER_OTLP_PROTOCOL<span class="ot">=</span><span class="st">"http"</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>OTEL_EXPORTER_OTLP_ENDPOINT<span class="ot">=</span><span class="st">"https://otlp-gateway-prod-eu-central-0.grafana.net/otlp"</span> \</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>OTEL_RESOURCE_ATTRIBUTES<span class="ot">=</span><span class="st">"service.name=&lt;name-of-your-app&gt;,service.namespace=&lt;name-of-your-namespace&gt;,deployment.environment=test"</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>OTEL_EXPORTER_OTLP_HEADERS<span class="ot">=</span><span class="st">"Authorization=Basic%20&lt;base64-encoded-token&gt;"</span></span></code></pre><p></p></div>
<p>See more examples below.</p></li>
<li><p>See all <a href="environmentvariables.html">environment variables</a> and
the manual of your chosen provider for details on configuring otelsdk
exporters.</p></li>
<li><p>Start R and your app. Telemetry data will be exported to the chosen exporter.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a></h2>

<div class="section">
<h3 id="setup-for-remote-collectors">Setup for remote collectors<a class="anchor" aria-label="anchor" href="#setup-for-remote-collectors"></a></h3>


<p>There are a lot of services that offer an OpenTelemetry collector for
tracers, logs and metrics, many of them supporting all three of them.
There are also local apps that work as a collector. We tried otelsdk with
the following ones:</p><div class="section">
<h4 id="grafana"><a href="https://grafana.com/" class="external-link">Grafana</a><a class="anchor" aria-label="anchor" href="#grafana"></a></h4>


<p>Follow the <a href="https://grafana.com/docs/grafana-cloud/send-data/otlp/send-data-otlp/#manual-opentelemetry-setup-for-advanced-users" class="external-link">documentation</a>.
Create an API token. You'll need to use the Grafana instrance ID as your
username, and the token as the password in HTTP Basic auth. E.g. in R do
this to get the base64 encoded token. <code>instance-id</code> is a (currently seven
digit) number and a string with a <code>glc_</code> prefix.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu">openssl</span><span class="fu">::</span><span class="fu"><a href="https://jeroen.r-universe.dev/openssl/reference/base64_encode.html" class="external-link">base64_encode</a></span><span class="op">(</span><span class="st">"&lt;instance-id&gt;:&lt;api-token&gt;"</span><span class="op">)</span></span></code></pre><p></p></div>
<p>Then use this encoded token to set the <code>Authorization</code> header:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>OTEL_EXPORTER_OTLP_PROTOCOL<span class="ot">=</span><span class="st">"http"</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>OTEL_EXPORTER_OTLP_ENDPOINT<span class="ot">=</span><span class="st">"https://otlp-gateway-prod-eu-central-0.grafana.net/otlp"</span> \</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>OTEL_EXPORTER_OTLP_HEADERS<span class="ot">=</span><span class="st">"Authorization=Basic%20&lt;base64-encoded-token&gt;"</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>OTEL_RESOURCE_ATTRIBUTES<span class="ot">=</span><span class="st">"service.name=&lt;name-of-your-app,service.namespace=&lt;name-of-your-namespace&gt;,deployment.environment=test"</span></span></code></pre><p></p></div>
<p>Your endpoint URL is probably different, use the one that you see on your
dashboard.</p>
<p>If you want to export logs and/or metrics, set these environment variables,
respectively:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>OTEL_LOGS_EXPORTER<span class="ot">=</span>http</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>OTEL_LOG_LEVEL<span class="ot">=</span>debug</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>OTEL_METRICS_EXPORTER<span class="ot">=</span>http</span></code></pre><p></p></div>
<p>It also makes sense to set the desired log level.</p>
<p>Grafana suggests running an OpenTelemetry collector on premise instead of
sending telemetry data to them directly. But nevertheless you can start out
without running your own collector, they call this "quick start" mode.</p>
</div>

<div class="section">
<h4 id="pydantic-logfire"><a href="https://pydantic.dev/logfire" class="external-link">Pydantic Logfire</a><a class="anchor" aria-label="anchor" href="#pydantic-logfire"></a></h4>


<p>Create a project and a write token. Note that the URLs you need to use
are different if you are within the EU! You probably need to replace <code>us</code>
with <code>eu</code> in the URL if you are in the EU. Set these environment variables:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>OTEL_TRACES_EXPORTER<span class="ot">=</span>http</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>OTEL_EXPORTER_OTLP_ENDPOINT<span class="ot">=</span><span class="st">"https://logfire-us.pydantic.dev"</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>OTEL_EXPORTER_OTLP_HEADERS<span class="ot">=</span><span class="st">"Authorization=&lt;your-write-token&gt;"</span></span></code></pre><p></p></div>
<p>For logs also set <code>OTEL_LOGS_EXPORTER</code> and the desired log level:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>OTEL_LOGS_EXPORTER<span class="ot">=</span>http</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>OTEL_LOG_LEVEL<span class="ot">=</span>debug</span></code></pre><p></p></div>
<p>For exporting metrics also set</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>OTEL_METRICS_EXPORTER<span class="ot">=</span>http</span></code></pre><p></p></div>
</div>


</div>

<div class="section">
<h3 id="setup-for-local-collectors">Setup for local collectors<a class="anchor" aria-label="anchor" href="#setup-for-local-collectors"></a></h3>

<div class="section">
<h4 id="otel-tui"><a href="https://github.com/ymtdzzz/otel-tui" class="external-link">otel-tui</a><a class="anchor" aria-label="anchor" href="#otel-tui"></a></h4>


<p><code>otel-tui</code> is a terminal app that supports traces, logs and metrics.
It is great for development, as you can keep all your telemetry local while
instrumenting your package or app. Follow the installation instructions and
then run the app from a terminal:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>otel<span class="sc">-</span>tui</span></code></pre><p></p></div>
<p>It listens on the default port, so the setup is very simple, set these
environment variables (or a subset if you don't want metrics or logs):</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>OTEL_TRACES_EXPORTER<span class="ot">=</span>http</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>OTEL_LOGS_EXPORTER<span class="ot">=</span>http</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>OTEL_LOG_LEVEL<span class="ot">=</span>debug</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>OTEL_METRICS_EXPORTER<span class="ot">=</span>http</span></code></pre><p></p></div>
</div>

<div class="section">
<h4 id="otel-desktop-viewer"><a href="https://github.com/CtrlSpice/otel-desktop-viewer" class="external-link">otel-desktop-viewer</a><a class="anchor" aria-label="anchor" href="#otel-desktop-viewer"></a></h4>


<p><code>otel-desktop-viewer</code> is similar to <code>otel-tui</code>, but has a web UI. Follow
the installation instructions and start the app from a terminal:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>otel<span class="sc">-</span>desktop<span class="sc">-</span>viewer</span></code></pre><p></p></div>
<p>It should start a new windows or tab in your local web browser. Set the
usual environment variable for your R app:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>OTEL_TRACES_EXPORTER<span class="ot">=</span>http</span></code></pre><p></p></div>
</div>

<div class="section">
<h4 id="jaeger"><a href="https://www.jaegertracing.io/" class="external-link">Jaeger</a><a class="anchor" aria-label="anchor" href="#jaeger"></a></h4>


<p>If you have Docker, you can start a
<a href="https://www.jaegertracing.io/" class="external-link">Jaeger</a> container on the default port:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>docker run <span class="sc">--</span>rm <span class="sc">--</span>name jaeger \</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a> <span class="sc">-</span>p <span class="dv">16686</span><span class="sc">:</span><span class="dv">16686</span> \</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a> <span class="sc">-</span>p <span class="dv">4317</span><span class="sc">:</span><span class="dv">4317</span> \</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a> <span class="sc">-</span>p <span class="dv">4318</span><span class="sc">:</span><span class="dv">4318</span> \</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a> <span class="sc">-</span>p <span class="dv">5778</span><span class="sc">:</span><span class="dv">5778</span> \</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a> <span class="sc">-</span>p <span class="dv">9411</span><span class="sc">:</span><span class="dv">9411</span> \</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a> jaegertracing<span class="sc">/</span>jaeger<span class="sc">:</span><span class="dv">2</span>.<span class="fl">4.0</span></span></code></pre><p></p></div>
<p>Go to <code>http://localhost:16686/</code> to view the Jaeger UI.</p>
</div>

<div class="section">
<h4 id="signoz"><a href="https://github.com/SigNoz/signoz" class="external-link">SigNoz</a><a class="anchor" aria-label="anchor" href="#signoz"></a></h4>


<p>To run SigNoz locally with Docker, clone the repository at
https://github.com/SigNoz/signoz:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>git clone <span class="sc">--</span>depth <span class="dv">1</span> https<span class="sc">:</span><span class="er">//</span>github.com<span class="sc">/</span>SigNoz<span class="sc">/</span>signoz</span></code></pre><p></p></div>
<p>and then run Docker Compose from the <code>deploy/docker/</code> subdirectory:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>cd deploy<span class="sc">/</span>docker</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>docker compose up</span></code></pre><p></p></div>
<p>Go to <code>http://localhost:8080</code> to see the SigNoz UI.</p>
</div>


</div>

    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># See above</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/gaborcsardi" class="external-link">Gábor Csárdi</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

  </div></footer></body></html>

